{% extends 'webapp/base.html' %}
{% block title %}Resultaten - MorphoAI{% endblock %}

{% block content %}
<div class="container mt-5">
    <h1 class="display-4 text-center mb-4">Morfologische Oefeningen</h1>

    <!-- Text Section -->
    <div class="card shadow-sm mb-4">
        <div class="card-body">
            <h4 class="card-title">Ingevoerde Tekst</h4>
            <p class="card-text text-muted">{{ text }}</p>
        </div>
    </div>

    <!-- Difficulty Level -->
    <div class="card shadow-sm mb-4">
        <div class="card-body">
            <h4 class="card-title">Geselecteerde Moeilijkheidsgraad</h4>
            <span class="badge bg-primary fs-5">{{ difficulty }}</span>
        </div>
    </div>

    <!-- Generated Exercises -->
    <div class="card shadow-sm mb-4">
        <div class="card-body">
            <h4 class="card-title">Gegenereerde Oefeningen</h4>
            <div  id="exercises-results" class="list-group">
                {% include 'webapp/partials/added_exercises.html' %}
            </div>

            <button class="btn btn-outline-success btn-sm mt-4" type="button" data-bs-toggle="collapse" data-bs-target="#answer{{ forloop.counter }}" aria-expanded="false" aria-controls="answer{{ forloop.counter }}">
                Add exercises
            </button>
            <div class="collapse mt-2" id="answer{{ forloop.counter }}">
              {% for exercise_type in exercise_types %}
                  <div class="form-group row justify-content-center mb-2">
                    <label for="exercise{{forloop.counter}}" class="col-sm-2 col-form-label text-right">{{exercise_type}}</label>
                    <div class="col-sm-3">
                      <input type="number" class="form-control exercise-input" id="{{exercise_type}}" min="0" max="5" step="1" value="0" minlength="1">
                    </div>
                  </div>
              {% endfor %}
              <button id="generate-new-exercises-btn" class="btn btn-sm btn-outline-success mt-2">Generate exercises</button>
                  
            </div>
        </div>
    </div>

    <script>
      document.getElementById('generate-new-exercises-btn').addEventListener('click', function() {
          const exercises = [];
          document.querySelectorAll('.exercise-input').forEach(input => {
              exercises.push({
                  type: input.id,
                  count: input.value
              });
          });
          
          fetch("{% url 'add_exercises' %}", {
              method: 'POST',
              headers: {
                  'Content-Type': 'application/json',
                  'X-Requested-With': 'XMLHttpRequest',  // Explicit header
                  'X-CSRFToken': '{{ csrf_token }}'
              },
              body: JSON.stringify({exercises: exercises})
          })
            .then(response => response.text())
            .then(html => {
                document.getElementById('exercises-results').innerHTML = html;
            })
      });
    </script>


    <!-- Download options popup -->
    <div class="modal fade" id="downloadModal" tabindex="-1" aria-hidden="true">
        <div class="modal-dialog">
          <div class="modal-content">
            <div class="modal-header">
              <h5 class="modal-title">Download Options</h5>
              <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body text-center">
              <p>Select the version you want to download:</p>
              <div class="d-grid gap-2">
                <a href="{% url 'download_exercises' %}?version=student" class="btn btn-primary btn-lg">
                  <i class="fas fa-user-graduate"></i> Student Version (Questions Only)
                </a>
                <a href="{% url 'download_exercises' %}?version=teacher" class="btn btn-success btn-lg">
                  <i class="fas fa-chalkboard-teacher"></i> Teacher Version (With Answers)
                </a>
              </div>
            </div>
          </div>
        </div>
      </div>
  

    <!-- Button to print and Generate New Exercise -->
    <div class="text-center mb-4">
        <button class="btn btn-primary btn-lg" data-bs-toggle="modal" data-bs-target="#downloadModal">
            <i class="fas fa-file-pdf"></i> Download PDF
        </button>
        
        
        <a href="{% url 'generate' %}" class="btn btn-lg btn-secondary">Nieuwe Oefening Genereren</a>
    </div>
</div>
{% endblock %}
